<!-- public/admin.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>叫號後台 - 那空沙旺</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <main class="container">
    <h1>🔒 老闆叫號後台</h1>

    <div id="auth-section">
      <input type="password" id="admin-password" placeholder="請輸入密碼">
      <button onclick="verifyPassword()">登入</button>
    </div>

    <div id="admin-panel" class="hidden">
      <h2>👥 目前號碼：<span id="current-number">尚未開始</span></h2>
      <p id="current-info">--</p>
      <button onclick="nextNumber()" class="primary">▶️ 下一號</button>
      <button onclick="resetQueue()" class="danger">🔁 重置所有號碼</button>
    </div>
  </main>

  <script>
    let password = '';

    function verifyPassword() {
      const input = document.getElementById('admin-password').value;
      if (input === 'sawanpass') {
        password = input;
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        fetchCurrent();
      } else {
        alert('密碼錯誤');
      }
    }

    async function fetchCurrent() {
      const res = await fetch(`/api/current`);
      const data = await res.json();
      if (data.current) {
        document.getElementById('current-number').textContent = `${data.current.number} 號`;
        document.getElementById('current-info').textContent = `${data.current.name} ${data.current.gender}`;
      }
    }

    async function nextNumber() {
      const res = await fetch(`/api/next?password=${password}`);
      const data = await res.json();
      if (data.success) fetchCurrent();
      else alert(data.message);
    }

    async function resetQueue() {
      if (confirm('確定要重置全部號碼嗎？')) {
        const res = await fetch(`/api/reset?password=${password}`);
        const data = await res.json();
        if (data.success) {
          alert('已重置');
          fetchCurrent();
        } else {
          alert(data.message);
        }
      }
    }
  </script>
</body>
</html>
